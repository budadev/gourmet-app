/* =============================
   Places Feature Styles
   ============================= */

.place-selector-section {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 2px solid var(--border-light);
}

.place-selector-section > label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--text-primary);
}

.place-search-wrapper {
  position: relative;
  display: flex;
  gap: 0;
  margin-bottom: 8px;
}

.place-search-input {
  flex: 1;
  padding: 12px 48px 12px 16px;
  background: var(--bg-secondary);
  border: 2px solid var(--border-light);
  border-radius: 12px;
  color: var(--text-primary);
  font-size: 15px;
  outline: none;
  transition: all 0.2s ease;
}

.place-search-input:focus {
  border-color: var(--primary);
  background: var(--bg-primary);
}

.place-add-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 32px;
  height: 32px;
  background: #10b981;
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 20px;
  font-weight: 300;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
}

.place-add-btn:hover {
  background: #059669;
  transform: translateY(-50%) scale(1.05);
  box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
}

.place-add-btn:active {
  transform: translateY(-50%) scale(0.95);
}

.place-add-btn.hidden {
  display: none;
}

.place-search-results {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  right: 0;
  background: var(--bg-secondary);
  border: 2px solid var(--border-light);
  border-radius: 12px;
  max-height: 240px;
  overflow-y: auto;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.place-search-results.hidden {
  display: none;
}

.place-search-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  cursor: pointer;
  transition: background 0.2s ease;
  border-bottom: 1px solid var(--border-light);
}

.place-search-item:last-child {
  border-bottom: none;
}

.place-search-item:hover {
  background: var(--bg-primary);
}

.place-search-item.selected {
  background: rgba(139, 92, 246, 0.1);
}

.place-search-item-icon {
  font-size: 18px;
}

.place-search-item-name {
  flex: 1;
  color: var(--text-primary);
  font-size: 15px;
}

.place-search-item-check {
  color: var(--primary);
  font-size: 18px;
  font-weight: bold;
}

.place-search-empty {
  padding: 16px;
  text-align: center;
  color: var(--text-muted);
  font-size: 14px;
}

.selected-places {
  margin-top: 12px;
}

.empty-places {
  padding: 12px;
  text-align: center;
  color: var(--text-muted);
  font-size: 14px;
  font-style: italic;
  background: var(--bg-secondary);
  border-radius: 8px;
}

.place-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.place-tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: var(--bg-secondary);
  border: 2px solid var(--border-light);
  border-radius: 20px;
  font-size: 14px;
  transition: all 0.2s ease;
}

.place-tag:hover {
  border-color: var(--primary);
  background: rgba(139, 92, 246, 0.1);
}

.place-tag-icon {
  font-size: 16px;
}

.place-tag-name {
  color: var(--text-primary);
  font-weight: 500;
}

.place-tag-remove {
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 20px;
  line-height: 1;
  cursor: pointer;
  padding: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.place-tag-remove:hover {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
}

/* Places in details view */
.place-badge {
  display: inline-block;
  padding: 6px 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-light);
  border-radius: 16px;
  font-size: 14px;
  margin-right: 8px;
  margin-bottom: 8px;
  color: var(--text-primary);
  transition: all 0.2s ease;
}

.place-badge.clickable {
  cursor: pointer;
}

.place-badge.clickable:hover {
  background: rgba(139, 92, 246, 0.15);
  border-color: var(--primary);
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(139, 92, 246, 0.2);
}

.place-badge.clickable:active {
  transform: translateY(0);
}

/* Make the dropdown position work within modal */
.modal-body .place-search-wrapper {
  position: relative;
}

.modal-body .place-search-results {
  position: absolute;
  z-index: 10001;
}

/* Sticky search in places modal */
#placesModal .search-wrapper {
  background: white;
}

#placesModal .modal-content {
  /* ensure the content container does not create its own scrollbar; the modal-body will be the single scroller */
  overflow: hidden;
}

#placesModal .modal-body {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  position: relative; /* keeps any absolutely positioned children positioned relative to modal body */
}

/* Let the modal body be the single scroll container. Remove internal list scrolling
   so items use the entire modal height when footer is hidden, and the body
   will automatically shrink when the footer appears (avoids double scrollbars). */
.places-list {
  /* no internal max-height/overflow here; modal-body handles scrolling */
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Disabled merge button */
#mergePlacesBtn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Places management page styles */
.places-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.places-list-item {
  display: flex;
  align-items: stretch;
  padding: 0;
  border: 1.5px solid var(--border-light);
  border-radius: 18px;
  background: #fff;
  box-shadow: 0 6px 24px rgba(0,0,0,0.08);
  position: relative;
  transition: background 0.2s, border-color 0.2s, box-shadow 0.2s, transform 0.2s;
}

.places-list-item::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  opacity: 0;
/* Centered modal content for place map popup (no overlay) */
.filter-place-map-modal-content {
  position: fixed;
  top: 50%;
  left: 50%;
  z-index: 1201;
  transform: translate(-50%, -50%);
  background: var(--bg-primary, #fff);
  border-radius: 18px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.18);
  max-width: 95vw;
  max-height: 95vh;
  overflow: auto;
  padding: 0;
  display: flex;
  flex-direction: column;
}
  transition: opacity var(--transition-fast) var(--ease);
  background: linear-gradient(120deg, rgba(59, 130, 246, .1), rgba(16, 185, 129, .1));
}

.places-list-item:hover {
  border-color: var(--primary-light);
  background: var(--card-hover);
  transform: translateY(-3px);
  box-shadow: var(--shadow-md);
}

.places-list-item:hover::before {
  opacity: 1;
}

.places-list-item-content {
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 100%;
  padding: 28px 28px 20px 28px;
  background: transparent;
  border-radius: 18px;
  box-shadow: none;
  margin-bottom: 0;
}

.places-list-item-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
  gap: 18px;
}

.places-list-item-name {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  flex: 1;
  line-height: 1.2;
  font-family: inherit;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.places-list-item-menu-btn {
  background: none;
  border: none;
  font-size: 20px;
  color: var(--text-muted);
  cursor: pointer;
  padding: 2px 10px 2px 10px;
  margin-left: 12px;
  border-radius: 50%;
  transition: background 0.15s, color 0.15s;
  display: flex;
  align-items: center;
  height: 32px;
  line-height: 1;
  font-weight: 400;
}
.places-list-item-menu-btn:hover {
  background: var(--bg-secondary);
  color: var(--primary);
}

.places-list-item-usage {
  font-size: 15px;
  color: var(--text-secondary);
  margin-bottom: 0;
  margin-left: 2px;
  font-family: inherit;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.places-list-item-menu {
  position: absolute;
  right: 20px;
  top: 100%;
  background: white;
  border: 1px solid var(--border-light);
  border-radius: 8px;
  box-shadow: var(--shadow-lg);
  z-index: 10000;
  min-width: 160px;
  display: flex;
  flex-direction: column;
}

.places-menu-option {
  background: none;
  border: none;
  padding: 12px 16px;
  text-align: left;
  font-size: 16px;
  color: var(--text-primary);
  cursor: pointer;
  transition: background 0.2s ease;
  border-bottom: 1px solid var(--border-light);
}

.places-menu-option:last-child {
  border-bottom: none;
}

.places-menu-option:hover {
  background: var(--bg-secondary);
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
}

.form-group input[type="text"] {
  width: 100%;
  border: 1px solid var(--border);
  background: var(--bg-secondary);
  border-radius: var(--radius-lg);
  padding: 14px 16px;
  font-size: 15px;
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, .04);
  transition: border var(--transition-fast) var(--ease), background var(--transition-fast) var(--ease), box-shadow var(--transition-fast) var(--ease);
  font-family: inherit;
  touch-action: manipulation;
}

.form-group input[type="text"]:focus {
  border-color: var(--primary);
  background: var(--card);
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.checkbox-label input {
  margin: 0;
}

/* Ensure menus and their options receive pointer events even when moved into body */
.places-list-item-menu,
.places-menu-option {
  pointer-events: auto;
}

/* When menu is moved into body, keep same visual style */
.places-list-item-menu {
  background: var(--card);
}

/* Larger, modern styled checkbox for merge mode */
.place-checkbox {
  width: 22px;
  height: 22px;
  accent-color: var(--primary, #2563eb);
  transform: scale(1.3);
  cursor: pointer;
  margin: 0;
  border-radius: 6px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}

.place-checkbox:focus {
  outline: 2px solid var(--primary, #2563eb);
  outline-offset: 2px;
}

/* Inline place editor popup */
.inline-place-editor {
  min-width: 220px;
  max-width: 320px;
  background: var(--bg-secondary);
  border: 1.5px solid var(--border-light);
  border-radius: 12px;
  padding: 10px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  display: flex;
  gap: 8px;
  align-items: center;
}

.inline-place-input {
  flex: 1;
  padding: 8px 10px;
  border: 1px solid var(--border-light);
  border-radius: 8px;
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
}

.inline-place-actions {
  display: block; /* actions are stacked */
}

.inline-place-actions .inline-place-save.btn.primary {
  width: 100%;
  display: block;
  padding: 12px 18px;
  font-size: 16px;
  text-align: center;
  box-sizing: border-box;
  border-radius: 12px;
}

.inline-place-cancel.btn {
  padding: 6px 8px;
  font-size: 13px;
  background: transparent;
  border: 1px solid var(--border-light);
  border-radius: 8px;
}

.inline-place-editor input:focus {
  border-color: var(--primary);
}

/* Hide the coordinate debug line below the map (kept in DOM for accessibility/debug but hidden visually) */
.inline-place-coords {
  display: none;
}

/* Backdrop for inline editor: darken background and center the popup */
.inline-place-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.72); /* slightly stronger */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 14000; /* ensure above other overlays */
  padding: 20px; /* spacing on small screens */
  -webkit-overflow-scrolling: touch;
}

/* Ensure the editor itself is centered and doesn't stretch full width */
.inline-place-backdrop .inline-place-editor {
  position: relative; /* keeps it centered inside backdrop */
  max-width: 560px;
  width: 100%;
  box-sizing: border-box;
  margin: 0 auto;
  padding: 16px 18px;
  display: flex;
  flex-direction: column; /* stack vertically: main row, then map */
  gap: 12px;
  align-items: stretch; /* stretch children to full width */
  border-radius: 14px;
  background: var(--card); /* use solid surface color */
  color: var(--text-primary);
  border: 1px solid rgba(0,0,0,0.08);
  box-shadow: 0 18px 40px rgba(0,0,0,0.6);
}

/* Main row: input on the left, actions (buttons) to the right */
.inline-place-main{
  display:flex;
  flex-direction:row;
  gap:12px;
  align-items:center;
  justify-content:space-between;
}

.inline-place-main .inline-place-input{
  flex:1 1 auto;
  min-width:120px;
}

.inline-place-main .inline-place-actions{
  display:flex;
  gap:8px;
  flex-shrink:0;
  margin-left:8px;
}

.inline-place-map-wrapper{
  width:100%;
  display:block;
  margin-top:0; /* spacing handled by container gap */
  margin-bottom: 8px;
  position: relative; /* allow absolute children */
}

.inline-place-map{
  width:100%;
  height:220px;
  border-radius:10px;
  overflow:hidden;
  display:block;
}

/* Center-to-user button inside inline map */
.inline-place-center-btn {
  position: absolute;
  bottom: 10px;
  left: 10px;
  z-index: 14001;
  width: 44px;
  height: 44px;
  border-radius: 10px;
  background: rgba(255,255,255,0.95);
  border: 1px solid var(--border-light);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  cursor: pointer;
  transition: transform 0.12s ease, background 0.12s ease, box-shadow 0.12s ease;
}

.inline-place-center-btn:active {
  transform: translateY(1px) scale(.99);
}

.inline-place-center-btn.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.inline-place-center-btn svg {
  width: 20px;
  height: 20px;
  fill: none;
  stroke: var(--primary);
  stroke-width: 1.8;
}

/* Loading state: hide icon and show spinner */
.inline-place-center-btn.loading svg { display: none; }
.inline-place-center-btn.loading { background: rgba(255,255,255,0.98); }
.inline-place-center-btn.loading::after {
  content: '';
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 3px solid rgba(0,0,0,0.12);
  border-top-color: var(--primary);
  animation: inline-place-spinner 0.9s linear infinite;
  display: block;
}

@keyframes inline-place-spinner {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@media (max-width:480px){
  .inline-place-backdrop .inline-place-editor{
    padding: 12px;
    gap: 8px;
  }
  .inline-place-backdrop .inline-place-editor .inline-place-input{
    font-size: 14px;
  }
}

/* Make popup field titles consistent with other form labels */
.inline-place-field-label,
.inline-place-map-title {
  display: block;
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 6px;
  font-weight: 600;
}

/* Ensure the search wrapper is positioned so results can align below the input */
.inline-place-map-search-wrapper {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
  align-items: center;
  position: relative; /* important for absolute-positioned results */
}

.inline-place-map-search-results {
  position: absolute;
  left: 0;
  right: 0;
  top: calc(100% + 6px);
  background: var(--card);
  border: 1px solid var(--border-light);
  border-radius: 10px;
  max-height: 220px;
  overflow-y: auto;
  z-index: 14002;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  padding: 8px; /* small padding for modern look */
}
.inline-place-map-search-results.hidden {
  display: none;
}

/* New: modern, spacious result items */
.inline-place-map-search-results .result-item {
  display: flex;
  gap: 8px;
  align-items: flex-start;
  padding: 8px 10px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 120ms ease, transform 120ms ease;
  margin-bottom: 6px;
}
.inline-place-map-search-results .result-item:last-child { margin-bottom: 0; }
.inline-place-map-search-results .result-item:hover {
  background: rgba(0,0,0,0.04);
  transform: translateY(-1px);
}
.inline-place-map-search-results .result-item .ri-main { display:flex; flex-direction:column; }
.inline-place-map-search-results .ri-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  line-height:1.2;
}
.inline-place-map-search-results .ri-sub {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 4px;
  max-height: 3.6em;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Clear (X) button inside search input */
.inline-place-map-search-clear {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  border: none;
  background: rgba(0,0,0,0.04);
  width: 28px;
  height: 28px;
  border-radius: 6px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  color: var(--text-primary);
}
.inline-place-map-search-clear:hover { background: rgba(0,0,0,0.06); }

/* make room for the clear button inside the input */
.inline-place-map-search { padding-right: 44px; }

/* Selected places (inline) - show tags in one row and wrap as needed */
.selected-places .place-list {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center; /* keep tags vertically centered */
}

/* Ensure individual tags size to their content instead of stretching */
.selected-places .place-tag {
  display: inline-flex;
  width: auto; /* override any stretching */
  max-width: calc(100% - 24px);
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

/* Modal overlay for place map filter */
.filter-place-map-modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  width: 100vw;
  height: 100vh;
  z-index: 1200;
  background: rgba(30, 32, 38, 0.45); /* semi-transparent dark backdrop */
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}

/* Center the modal content (the popup itself) */
.filter-place-map-modal > * {
  margin: 0;
  box-shadow: 0 8px 32px rgba(0,0,0,0.18);
  border-radius: 18px;
  background: var(--bg-primary, #fff);
  max-width: 95vw;
  max-height: 95vh;
  overflow: auto;
  padding: 0;
}
